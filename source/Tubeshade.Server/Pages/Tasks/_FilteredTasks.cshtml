@using Tubeshade.Data.Tasks
@using Tubeshade.Server.Pages.Shared
@model ITaskPage

<form method="get" class="row row-cols-2 row-cols-sm-auto g-2 align-items-center mb-2"
      hx-get="" hx-page-handler="" hx-params="*" hx-push-url="true"
      hx-trigger="input changed delay:100ms" hx-target="#tasks"
      id="filter">

    <div class="col-6">
        <label asp-for="PageSize" hidden="hidden">@SharedResources.Filters_PageSize</label>
        <input asp-for="PageSize" class="form-control" type="number" placeholder="@SharedResources.Filters_PageSize"
               value="@(Model.PageSize is null or Defaults.PageSize ? null : Model.PageSize)"/>
    </div>

    <div class="col-12">
        <label asp-for="Source" hidden="hidden">@SharedResources.Tasks_TaskSource</label>
        <select asp-for="Source" class="form-select">
            <option value="">@SharedResources.Tasks_TaskSource_All</option>
            @foreach (var source in TaskSource.List)
            {
                <option value="@source.Name">@source.LocalizedName</option>
            }
        </select>
    </div>

    <div class="col-6">
        <div class="form-check">
            <input id="task-polling" type="checkbox" checked="checked" class="form-check-input"
                   hx-on:change="onPollingChanged()"/>
            <label for="task-polling" class="form-check-label">
                @SharedResources.Tasks_RefreshAutomatically
            </label>
        </div>
    </div>

    <input asp-for="PageIndex" value="@Model.PageIndex" hidden="hidden"/>

    <div class="col-6">
        <button hx-post="" hx-page-handler="ScanSubscriptions" class="btn btn-primary w-100" type="button">
            @SharedResources.Button_ScanSubscriptions
        </button>
    </div>

    <div class="col-6">
        <button hx-post="" hx-page-handler="ScanSegments" class="btn btn-primary w-100" type="button">
            @SharedResources.Button_ScanSponsorBlock
        </button>
    </div>

    <div class="col-6">
        <button hx-post="" hx-page-handler="UpdateSegments" class="btn btn-primary w-100" type="button">
            @SharedResources.Button_UpdateSponsorBlock
        </button>
    </div>

</form>

<partial name="Tasks/_RunningTasks" model="@Model"/>
